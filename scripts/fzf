#!/usr/bin/env bash

if [ -d /dev/shm/ ]; then
    file=/dev/shm/fzftemp
else
    file=$(elisp -r '(~ "fzftemp")')
fi

if [ -p /dev/stdin ]; then
    cat - > "$file"
else
    rg --files "$@" > "$file"
fi

export elisp_timeout=10
elisp -r '(ivy-read "" (s-split "\n" (f-read "'"$file"'")) :action (lambda(option) option))'
