#!/bin/sh

if [ -d /dev/shm/ ]; then
    file=/dev/shm/fzftemp
else
    file=$(elisp -r '(~ "fzftemp")')
fi

if [ -p /dev/stdin ]; then
    cat - > "$file"
else
    rg --files "$@" > "$file"
fi

elisp_timeout=10 elisp -r '(condition-case () (ivy-read "" (s-split "\n" (f-read "'"$file"'")) :action (lambda(option) option)) (quit nil))'
